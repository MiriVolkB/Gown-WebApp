generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url        = "postgres://postgres.qpilhhrdijebwcpovabs:RachelliGowns25@aws-1-ap-southeast-2.pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=1"
  directUrl = "postgresql://postgres:RachelliGowns25@db.qpilhhrdijebwcpovabs.supabase.co:5432/postgres"
}

model Client {
  id            Int             @id @default(autoincrement())
  name          String
  email         String?
  phone         String
  WeddingDate   DateTime?
  dueDate      DateTime?  @map("needGownBy")
  Recommended   String?
  notes         String?

  projects     Project[]     
  payments     Payment[]
  appointments  Appointment[]
  createdAt     DateTime        @default(now())
}

model Measurement {
  id        Int      @id @default(autoincrement())
  projectId  Int
  date      DateTime @default(now())
  Bust      Float
  waist     Float
  Hips     Float
  ShirtLength     Float
  SkirtLength     Float
  SleeveLength     Float
  SleeveWidth     Float
  ShoulderToBust   Float
  notes     String?
  project   Project  @relation(fields: [projectId], references: [id])
}

model Appointment {
  id              Int        @id @default(autoincrement())
  clientId        Int
  client          Client     @relation(fields: [clientId], references: [id])
  serviceId       Int
  service         Service    @relation(fields: [serviceId], references: [id])
  start           DateTime   // start date + time
  end             DateTime   // end date + time
  durationMinutes Int        // store actual duration, default from service but editable
  status          String     @default("SCHEDULED") 
  date            DateTime
  notes           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

model Service {
  id                 Int             @id @default(autoincrement())
  name               String          // "First fitting", "Second fitting", "Pickup"
  defaultDurationMin Int             // 30, 45, 60, etc.
  color              String?         // Optional: hex color for calendar
  active             Boolean         @default(true)

  appointments       Appointment[]
}

model Project {
  id           Int           @id @default(autoincrement())
  clientId     Int
  client       Client        @relation(fields: [clientId], references: [id])
  
  memberName   String        // e.g., "Sarah"
  orderType    OrderType     @default(RENTAL) 
  
  // FIXED BUT FLEXIBLE: Defaulted in UI, but saved here so you can change it
  price        Float         
  
  measurements Measurement[]
  expenses     Expense[]     
}

enum OrderType {
  CUSTOM_MAKE
  RENTAL
}

model Expense {
  id        Int      @id @default(autoincrement())
  projectId Int
  project   Project  @relation(fields: [projectId], references: [id])
  
  type      String   // "Dying", "Beading", etc.
  amount    Float
  date      DateTime @default(now())
}

model Payment {
  id        Int      @id @default(autoincrement())
  clientId  Int
  client    Client   @relation(fields: [clientId], references: [id])
  amount    Float    
  date      DateTime @default(now())
  note      String?  
}